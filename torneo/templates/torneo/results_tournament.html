{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
Resultados: ronda {{round}} de {{num_rounds}}
{% endblock %}

{% block content %}
<p> Usted hizo {{tasks}} secuencias correctamente.<br>
    Sus ganancias en esta ronda son {{payoff_round}}.</p>

{% if round < num_rounds %} 
<!--Ranking -->
<style>
    table {
      border-collapse: collapse;
      width: 80%;
    }
    
    td, th {
      border: 1px solid #dddddd;
      text-align: center;
      padding: 8px;
    }
    
    tr:nth-child(even) {
      background-color: #dddddd;
    }
    table.center {
      margin-left: auto; 
      margin-right: auto;
    }
    </style>

<table class="center">

    <tr>      
      <th scope="row">Ranking</th>      
      <th>Puesto y contrato</th>
      <th>Secuencias correctas</th>      
      <th>Probabilidad Contrato A - ronda {{round_next}} </th>      
    </tr>
  
    <tr>
      <th>1</th>      
      <td>Primer puesto de los participantes con <i>Contrato A</i></td> 
      <td>{{tasks_p1}}</td>      
      <td>
            {% if discrimination == 0 %}
                50%
            {% else %}
                100%
            {% endif %}  
      </td>                
    </tr>

    <tr>      
        <th>2</th>        
        <td>Segundo puesto de los participantes con <i>Contrato A</i></td>
        <td>{{tasks_p2}}</td>        
        <td>{{likelihood_contract_A_p2}}</td>                     
    </tr>
    <tr>      
        <th>3</th>
        <td>Primer puesto de los participantes con <i>Contrato B</i></td>
        <td>{{tasks_p3}}</td>        
        <td>{{likelihood_contract_A_p3}}</td>                  
    </tr>

    <tr>
        <th>4</th>        
        <td>Segundo puesto de los participantes con <i>Contrato B</i></td>
        <td>{{tasks_p4}}</td>        
        <td>
            {% if discrimination == 0 %}
                50%
            {% else %}
                0%
            {% endif %}  
        </td>            
    </tr>
  
  </table>

   <br>

    <h5> Ranking y probabilidad de tener un Contrato A en la siguiente ronda</h5>
    <style>
        h1 {
            color:green;
        }
        .xyz {
            background-size: auto;
            text-align: center;
            padding-top: 100px;
        }
        .btn-circle.btn-sm {
            width: 30px;
            height: 30px;
            padding: 6px 0px;
            border-radius: 15px;
            font-size: 8px;
            text-align: center;
        }
        .btn-circle.btn-md {
            width: 50px;
            height: 50px;
            padding: 7px 10px;
            border-radius: 25px;
            font-size: 10px;
            text-align: center;
        }
        .btn-circle.btn-xl {
            width: 70px;
            height: 70px;
            padding: 10px 16px;
            border-radius: 35px;
            font-size: 12px;
            text-align: center;
        }
        table {
            border-collapse: collapse;
            width: 80%;
        }

        td,
        th {
            border: 1px solid #dddddd;
            text-align: center;
            padding: 8px;
        }

        table.center {
            margin-left: auto;
            margin-right: auto;
        }
    </style>

    <table class="center">

        <tr>
            <th scope="row" style="width:100px;">Ranking</th>
            <th>Puesto y contrato</th>
            <th style="width:200px;">Probabilidad Contrato A</th>
        </tr>
        <tr>
            <th style="width:100px;">
                {% if contract_A %}
                {% if position_contract == 1 %}
                1
                {% else %}
                2
                {% endif %}
                {% else %}
                {% if position_contract == 1 %}
                3
                {% else %}
                4
                {% endif %}
                {% endif %}
            </th>
            <td>
                {% if contract_A %}
                {% if position_contract == 1 %}
                Primer puesto de los participantes con <i>Contrato A
                    {% else %}
                    Segundo puesto de los participantes con <i>Contrato A
                        {% endif %}
                        {% else %}
                        {% if position_contract == 1 %}
                        Primer puesto de los participantes con <i>Contrato B</i>
                        {% else %}
                        Segundo puesto de los participantes con <i>Contrato B</i>
                        {% endif %}
                        {% endif %}
            </td>
            <td style="width:200px;">
                {% if discrimination == 0 %}
                {{likelihood_contract_A}}
                {% else %}
                {% if contract_A == 1 and position_contract == 1 or contract_A == 0 and position_contract == 2%}
                {{likelihood_contract_A}}
                {% else %}
                Repechaje
                {% endif %}
                {% endif %}
            </td>
        </tr>
    </table>

    <!--Repechaje -->
    {% if discrimination != 0 %}
    {% if contract_A == 1 and position_contract == 2 or contract_A == 0 and position_contract == 1 %}
    <h6> Repechaje </h6>
    Los participantes en el Ranking <b>2</b> y <b>3</b> pueden cambiar de contrato dependiendo del n√∫mero de secuencias
    correctas que hayan realizado

    <table class="center">
        <tr>
            <th scope="row" style="width:100px;">Ranking</th>
            <th>Secuencias correctas</th>
            <th style="width:200px;">Probabilidad Contrato A</th>
        </tr>

        <tr>
            <td style="width:100px;">
                <b>
                    {% if contract_A %}
                    2
                    {% else %}
                    3
                    {% endif %}
                </b>(usted)
            </td>
            <td>
                {{tasks}}
            </td>
            <td style="width:200px;">
                {{likelihood_contract_A}}
            </td>
        </tr>
        <tr>
            <td style="width:100px;">
                <b>{% if contract_A %}
                    3
                    {% else %}
                    2
                    {% endif %}
                </b>(el otro)
            </td>
            <td>
                {{tasks_other}}
            </td>
            <td style="width:200px;">
                {{likelihood_contract_A_other}}
            </td>
        </tr>   
    </table>
    <canvas id="myChart" width="100" height="100"></canvas>
    <button type="button" class="btn btn-warning btn-circle btn-xl">Haz clic Resultado repechaje</button>
    {% endif %}
    {% endif %}
    <p>Haga clic en "Siguiente" para conocer su contrato para la ronda {{round_next}}.</p>
    
    {% endif %}
    {% next_button %}
    {% endblock %}
    {% block global_scripts  %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js"></script>
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var you = '{{likelihood_contract_A_number}}';
        you = parseFloat(you.replace(',', '.'))*100
        var other = (100 - you);

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Usted', 'El otro',],
                datasets: [{
                    label: 'Probabilidad contrato A',
                    data: [you, other],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
    {% endblock %}
{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
Resultados: ronda {{round}} de {{num_rounds}}
{% endblock %}

{% block content %}
<p> Usted hizo {{tasks}} secuencias correctamente. Sus ganancias en esta ronda son {{payoff_round}}.
<p>
    {% if round < num_rounds %} Su posición en el ranking grupal es <b>
        {% if contract_A %}
        {% if position_contract == 1 %}
        1
        {% else %}
        2
        {% endif %}
        {% else %}
        {% if position_contract == 1 %}
        3
        {% else %}
        4
        {% endif %}
        {% endif %}
        </b>.

        {% if contract_A %}
        {% if position_contract == 1 %}
        Fue quien más tareas realizó entre las personas con Contrato A de su grupo en esta ronda.
        {% else %}
        Fue quien menos tareas realizó entre las personas con Contrato A de su grupo en esta ronda.
        {% endif %}
        {% else %}
        {% if position_contract == 1 %}
        Fue quien más tareas realizó entre las personas con Contrato B de su grupo en esta ronda.
        {% else %}
        Fue quien menos tareas realizó entre las personas con Contrato B de su grupo en esta ronda.
        {% endif %}
        {% endif %}
        <br>
        <!--Repechaje -->
        {% if discrimination != 0 %}
        {% if contract_A == 1 and position_contract == 2 or contract_A == 0 and position_contract == 1 %}
        En el <i>repechaje</i> usted podrá cambiar de contrato con el participante en el ranking <b>
            {% if contract_A == 1 and position_contract == 2%}
            3 </b> (Contrato B).
        {% else %}
        2 </b> (Contrato A).
        {% endif %}
        {% endif %}
</p>
<!--Ranking -->
<style>
    .btn-circle.btn-xl {
            width: 70px;
            height: 70px;
            padding: 10px 16px;
            border-radius: 35px;
            font-size: 12px;
            text-align: center;
    }

    .selected {
        background-color: rgba(240, 255, 0, 0.2);
    }

    table {
        border-collapse: collapse;
        width: 80%;
    }

    td,
    th {
        border: 1px solid #dddddd;
        text-align: center;
        padding: 8px;
    }

    table.center {
        margin-left: auto;
        margin-right: auto;
    }
</style>

<table id="table-ranking" class="center">

    <tr>
        <th scope="row">Ranking</th>
        <th>Puesto y contrato</th>
        <th>Secuencias correctas</th>
        <th>Probabilidad Contrato A - ronda {{round_next}} </th>
    </tr>

    <tr>
        <th>1</th>
        <td>Primer puesto de los participantes con <i>Contrato A</i></td>
        <td>{{tasks_p1}}</td>
        <td>
            {% if discrimination == 0 %}
            50%
            {% else %}
            100%
            {% endif %}
        </td>
    </tr>

    <tr>
        <th>2</th>
        <td>Segundo puesto de los participantes con <i>Contrato A</i></td>
        <td>{{tasks_p2}}</td>
        <td>{{likelihood_contract_A_p2}}</td>
    </tr>
    <tr>
        <th>3</th>
        <td>Primer puesto de los participantes con <i>Contrato B</i></td>
        <td>{{tasks_p3}}</td>
        <td>{{likelihood_contract_A_p3}}</td>
    </tr>

    <tr>
        <th>4</th>
        <td>Segundo puesto de los participantes con <i>Contrato B</i></td>
        <td>{{tasks_p4}}</td>
        <td>
            {% if discrimination == 0 %}
            50%
            {% else %}
            0%
            {% endif %}
        </td>
    </tr>
</table>

<script>
    var ranking = '{{position_ranking}}';
    ranking = parseInt(ranking, 10);
    console.log(ranking);

    function selectedRow() {
        var index,
            table = document.getElementById("table-ranking");
        for (var i = 0; i < table.rows.length; i++) {
            if (i == ranking) {
                table.rows[i].classList.toggle("selected");
            }
        }
    }
    selectedRow();
</script>
<br>

{% if discrimination != 0 %}
{% if contract_A == 1 and position_contract == 2 or contract_A == 0 and position_contract == 1 %}
<h5> Repechaje </h5>
<canvas id="myChart" width="100" height="100"></canvas>

<p>Haga clic en el circulo amarillo para el resultado del repechaje.</p>
<button type="button" class="btn btn-warning btn-circle btn-xl">Resultado repechaje</button>
{% endif %}
{% endif %}


{% endif %}
<!--Fin Repechaje -->

{% endif %}
<br>
{% next_button %}
{% endblock %}
{% block global_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.0/dist/chart.min.js"></script>
<script>
    var ctx = document.getElementById('myChart').getContext('2d');
    var you = '{{likelihood_contract_A_number}}';
    you = parseFloat(you.replace(',', '.')) * 100
    var other = (100 - you);

    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Usted', 'El otro',],
            datasets: [{
                label: 'Probabilidad contrato A',
                data: [you, other],
                backgroundColor: [
                    'rgba(240, 255, 0, 0.2)',
                    'rgba(255, 255, 255, 0)'
                ],
                borderColor: [
                    'rgba(0, 0, 0, 1)',
                ],
                borderWidth: 1
            }]
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Probabilidad Contrato A [%] de participantes en Repechaje',
                    padding: {
                        top: 10,
                        bottom: 30
                    },
                    font: {size:15}
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}